async function h(t){t.template=t.template||{},t.template.path=t.template.path||`${t.codeBasePath}/blocks/${t.blockName}/${t.blockName}.html`;let e=`faintly-template-${t.template.path}#${t.template.name||""}`.toLowerCase().replace(/[^0-9a-z]/gi,"-"),a=document.getElementById(e);if(!a){let r=await fetch(t.template.path);if(!r.ok)throw new Error(`Failed to fetch template from ${t.template.path} for block ${t.blockName}.`);let s=await r.text();new DOMParser().parseFromString(s,"text/html").querySelectorAll("template").forEach(i=>{let p=i.getAttribute("data-fly-name")||"";i.id=`faintly-template-${t.template.path}#${p}`.toLowerCase().replace(/[^0-9a-z]/gi,"-"),document.body.append(i)})}if(a=document.getElementById(e),!a)throw new Error(`Failed to find template with id ${e}.`);return a}async function c(t,e){let a=e,r,s=t.split(".");for(let n=0;n<s.length&&!(typeof a>"u");n+=1){let o=s[n];if(r=a,a=a[o],typeof a=="function"){let i=[{...e}];a=await a.apply(r,i)}}return a}async function d(t,e){let a=/(\\)?\${([a-z0-9\\.\s]+)}/dgi,r=[];if(t.replaceAll(a,(s,n,o)=>(n&&r.push(Promise.resolve(s.slice(1))),r.push(c(o.trim(),e)),s)),r.length>0){let s=await Promise.all(r);return{updated:!0,updatedText:t.replaceAll(a,()=>s.shift())}}return{updated:!1,updatedText:t}}async function b(t,e){let{updated:a,updatedText:r}=await d(t.textContent,e);a&&(t.textContent=r)}async function P(t,e){if(!t.hasAttribute("data-fly-attributes"))return;let a=t.getAttribute("data-fly-attributes"),r=await c(a,e);t.removeAttribute("data-fly-attributes"),r&&Object.entries(r).forEach(([s,n])=>{n===void 0?t.removeAttribute(s):t.setAttribute(s,n)})}async function A(t,e){P(t,e);let a=t.getAttributeNames().filter(r=>!r.startsWith("data-fly-")).map(async r=>{let{updated:s,updatedText:n}=await d(t.getAttribute(r),e);s&&t.setAttribute(r,n)});await Promise.all(a)}async function N(t,e){let a=t.getAttributeNames().find(p=>p.startsWith("data-fly-test")||p.startsWith("data-fly-not"));if(!a)return!0;let s=a.split(".")[1]||"",n=t.getAttribute(a),o=await c(n,e);t.removeAttribute(a);let i=a.startsWith("data-fly-not")?!o:!!o;return s&&(e[s.toLowerCase()]=i),i||t.remove(),i}async function E(t,e){if(!t.hasAttribute("data-fly-content"))return!1;let a=t.getAttribute("data-fly-content"),r=await c(a,e);if(t.removeAttribute("data-fly-content"),r!==void 0)if(r instanceof Node)t.replaceChildren(r);else if(Array.isArray(r)||r instanceof NodeList||r instanceof HTMLCollection)t.replaceChildren(...r);else{let s=document.createTextNode(r);t.replaceChildren(s)}else t.textContent="";return!0}async function T(t,e){let a=t.getAttributeNames().find(l=>l.startsWith("data-fly-repeat"));if(!a)return!1;let s=a.split(".")[1]||"item",n=t.getAttribute(a),o=await c(n,e);if(!o||Object.keys(o).length===0)return t.remove(),!0;t.removeAttribute(a);let i=await Promise.all(Object.entries(o).map(async([l,x],w)=>{let y=t.cloneNode(!0),u={...e};return u[s.toLowerCase()]=x,u[`${s.toLowerCase()}Index`]=w,u[`${s.toLowerCase()}Number`]=w+1,u[`${s.toLowerCase()}Key`]=l,await f(y,u),y})),p=t;return i.forEach(l=>{p.after(l),p=l}),t.remove(),!0}async function v(t,e){if(!t.hasAttribute("data-fly-include"))return!1;let a=t.getAttribute("data-fly-include");t.removeAttribute("data-fly-include");let{updatedText:r}=await d(a,e),s=e.template?e.template.path:"",n=r;if(n.startsWith("/")){let[i,p]=n.split("#");s=i,n=p}let o={...e,template:{name:n,path:s}};return await m(t,o),!0}async function g(t,e){if(!t.hasAttribute("data-fly-unwrap"))return;let a=t.getAttribute("data-fly-unwrap");a&&(await c(a,e)||t.removeAttribute("data-fly-unwrap"))}function C(t){t.querySelectorAll("[data-fly-unwrap]").forEach(e=>{e.before(...e.childNodes),e.remove()})}async function f(t,e){e.currentNode=t;let a=[Node.ELEMENT_NODE,Node.DOCUMENT_FRAGMENT_NODE].includes(t.nodeType);if(t.nodeType===Node.ELEMENT_NODE){if(!await N(t,e)||await T(t,e))return;await A(t,e),a=await E(t,e)||await v(t,e)||!0,await g(t,e)}else t.nodeType===Node.TEXT_NODE&&await b(t,e);let r=a?[...t.childNodes]:[];for(let s=0;s<r.length;s+=1){let n=r[s];await f(n,e)}}async function $(t,e){let a=t.cloneNode(!0);return await f(a.content,e),C(a.content),a}async function L(t,e,a){let r=await $(e,a);t.replaceChildren(r.content)}async function m(t,e){let a=await h(e);await L(t,a,e)}async function k(t,e={}){e.block=t,e.blockName=t.dataset.blockName,e.codeBasePath=e.codeBasePath||(window.hlx?window.hlx.codeBasePath:""),await m(t,e)}export{k as renderBlock,m as renderElement};
//# sourceMappingURL=faintly.min.js.map
